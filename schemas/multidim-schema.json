{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "additionalProperties": false,
    "type": "object",
    "properties": {
        "grapherConfigSchema": {
            "description": "URL of a JSON schema for the grapher config.",
            "type": "string"
        },
        "title": {
            "type": "object",
            "properties": {
                "title": {
                    "type": "string"
                },
                "titleVariant": {
                    "type": "string"
                }
            },
            "required": [
                "title",
                "titleVariant"
            ]
        },
        "defaultSelection": {
            "type": "array",
            "items": {
                "type": "string"
            }
        },
        "topicTags": {
            "type": "array",
            "items": {
                "type": "string"
            }
        },
        "dimensions": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "slug": {
                        "type": "string"
                    },
                    "name": {
                        "type": "string"
                    },
                    "description": {
                        "type": "string"
                    },
                    "choices": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "slug": {
                                    "type": "string"
                                },
                                "name": {
                                    "type": "string"
                                },
                                "group": {
                                    "type": "string"
                                },
                                "description": {
                                    "type": [
                                        "string",
                                        "null"
                                    ]
                                }
                            },
                            "required": [
                                "slug",
                                "name"
                            ]
                        }
                    }
                },
                "required": [
                    "slug",
                    "name"
                ]
            }
        },
        "views": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "dimensions": {
                        "type": "object",
                        "patternProperties": {
                            ".*": {
                                "type": "string"
                            }
                        }
                    },
                    "indicators": {
                        "type": "object",
                        "properties": {
                            "y": {
                                "oneOf": [
                                    {
                                        "type": "string"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "oneOf": [
                                                {
                                                    "type": "string"
                                                },
                                                {
                                                    "$ref": "#/$defs/indicatorConfig"
                                                }
                                            ]
                                        }
                                    },
                                    {
                                        "$ref": "#/$defs/indicatorConfig"
                                    }
                                ]
                            },
                            "x": {
                                "oneOf": [
                                    {
                                        "type": "string"
                                    },
                                    {
                                        "$ref": "#/$defs/indicatorConfig"
                                    }
                                ]
                            },
                            "size": {
                                "oneOf": [
                                    {
                                        "type": "string"
                                    },
                                    {
                                        "$ref": "#/$defs/indicatorConfig"
                                    }
                                ]
                            },
                            "color": {
                                "oneOf": [
                                    {
                                        "type": "string"
                                    },
                                    {
                                        "$ref": "#/$defs/indicatorConfig"
                                    }
                                ]
                            }
                        },
                        "required": [
                            "y"
                        ]
                    },
                    "config": {
                        "$ref": "https://files.ourworldindata.org/schemas/grapher-schema.006.json"
                    },
                    "metadata": {
                        "description": "Overrides metadata for the view. Takes precedence over the metadata override for all views.",
                        "$ref": "#/$defs/metadata"
                    }
                }
            }
        },
        "metadata": {
            "description": "Override metadata for all views.",
            "$ref": "#/$defs/metadata"
        }
    },
    "required": [
        "title",
        "defaultSelection",
        "dimensions",
        "views"
    ],
    "$defs": {
        "indicatorConfig": {
            "type": "object",
            "properties": {
                "catalogPath": {
                    "type": "string"
                },
                "display": {
                    "description": "Overrides the display settings for the indicator.",
                    "$ref": "https://files.ourworldindata.org/schemas/grapher-schema.006.json#/properties/dimensions/items/properties/display"
                }
            },
            "required": [
                "catalogPath"
            ]
        },
        "license": {
            "type": "object",
            "properties": {
                "name": {
                    "type": "string"
                },
                "url": {
                    "type": "string"
                }
            },
            "required": [
                "name",
                "url"
            ]
        },
        "metadata": {
            "type": "object",
            "properties": {
                "name": {
                    "type": "string"
                },
                "description": {
                    "type": "string"
                },
                "descriptionShort": {
                    "type": "string"
                },
                "descriptionFromProducer": {
                    "type": "string"
                },
                "descriptionKey": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "descriptionProcessing": {
                    "type": "string"
                },
                "unit": {
                    "type": "string"
                },
                "shortUnit": {
                    "type": "string"
                },
                "datasetName": {
                    "type": "string"
                },
                "datasetId": {
                    "type": "number"
                },
                "coverage": {
                    "type": "string"
                },
                "nonRedistributable": {
                    "type": "boolean"
                },
                "source": {
                    "type": "object",
                    "properties": {
                        "id": {
                            "type": "number"
                        },
                        "name": {
                            "type": "string"
                        },
                        "dataPublishedBy": {
                            "type": "string"
                        },
                        "dataPublisherSource": {
                            "type": "string"
                        },
                        "link": {
                            "type": "string"
                        },
                        "retrievedDate": {
                            "type": "string"
                        },
                        "additionalInfo": {
                            "type": "string"
                        }
                    }
                },
                "origins": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "number"
                            },
                            "title": {
                                "type": "string"
                            },
                            "titleSnapshot": {
                                "type": "string"
                            },
                            "attribution": {
                                "type": "string"
                            },
                            "attributionShort": {
                                "type": "string"
                            },
                            "versionProducer": {
                                "type": "string"
                            },
                            "license": {
                                "$ref": "#/$defs/license"
                            },
                            "descriptionSnapshot": {
                                "type": "string"
                            },
                            "description": {
                                "type": "string"
                            },
                            "producer": {
                                "type": "string"
                            },
                            "citationFull": {
                                "type": "string"
                            },
                            "urlMain": {
                                "type": "string"
                            },
                            "urlDownload": {
                                "type": "string"
                            },
                            "dateAccessed": {
                                "type": "string"
                            },
                            "datePublished": {
                                "type": "string"
                            }
                        }
                    }
                },
                "schemaVersion": {
                    "type": "number"
                },
                "processingLevel": {
                    "type": "string",
                    "enum": [
                        "minor",
                        "major"
                    ]
                },
                "presentation": {
                    "type": "object",
                    "properties": {
                        "titlePublic": {
                            "type": "string"
                        },
                        "titleVariant": {
                            "type": "string"
                        },
                        "attributionShort": {
                            "type": "string"
                        },
                        "attribution": {
                            "type": "string"
                        },
                        "topicTagsLinks": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        },
                        "faqs": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "gdocId": {
                                        "type": "string"
                                    },
                                    "fragmentId": {
                                        "type": "string"
                                    }
                                },
                                "required": [
                                    "gdocId",
                                    "fragmentId"
                                ]
                            }
                        }
                    }
                },
                "shortName": {
                    "type": "string"
                },
                "timespan": {
                    "type": "string"
                },
                "catalogPath": {
                    "type": "string"
                },
                "license": {
                    "$ref": "#/$defs/license"
                },
                "updatePeriodDays": {
                    "type": "number"
                },
                "datasetVersion": {
                    "type": "string"
                },
                "licenses": {
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/license"
                    }
                },
                "type": {
                    "type": "string",
                    "enum": [
                        "string",
                        "float",
                        "int",
                        "mixed",
                        "ordinal"
                    ]
                }
            }
        }
    }
}
