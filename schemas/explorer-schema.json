{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "additionalProperties": false,
    "type": "object",
    "properties": {
        "definitions": {
            "type": "object",
            "description": "Definitions with anchors that are reused in other parts of the metadata",
            "additionalProperties": true,
            "properties": {
                "grapherSchemaRef": {
                    "type": "string",
                    "const": "https://files.ourworldindata.org/schemas/grapher-schema.007.json"
                }
            }
        },
        "grapherConfigSchema": {
            "description": "URL of a JSON schema for the grapher config.",
            "type": "string"
        },
        "title": {
            "type": "object",
            "properties": {
                "title": {
                    "type": "string"
                },
                "title_variant": {
                    "type": "string"
                }
            },
            "required": [
                "title",
                "title_variant"
            ],
            "additionalProperties": false
        },
        "default_selection": {
            "type": "array",
            "items": {
                "type": "string"
            }
        },
        "config": {
            "type": "object",
            "description": "Explorer configuration options",
            "properties": {
                "explorerTitle": {
                    "type": "string",
                    "description": "Title of the explorer"
                },
                "explorerSubtitle": {
                    "type": "string",
                    "description": "Subtitle of the explorer"
                },
                "isPublished": {
                    "type": "boolean",
                    "description": "Whether the explorer is published"
                },
                "selection": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Default selected entities"
                },
                "thumbnail": {
                    "type": "string",
                    "description": "URL to the explorer thumbnail"
                },
                "subNavId": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "ID of the subnav"
                },
                "subNavCurrentId": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Current ID in the subnav"
                },
                "hasMapTab": {
                    "type": "boolean",
                    "description": "Whether to show a map tab"
                },
                "yAxisMin": {
                    "type": "number",
                    "description": "Minimum value for the Y axis"
                },
                "pickerColumnSlugs": {
                    "oneOf": [
                        {
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        }
                    ],
                    "description": "Column slugs for the entity picker"
                },
                "hideAnnotationFieldsInTitle": {
                    "type": "boolean",
                    "description": "Whether to hide annotation fields in the title"
                },
                "tab": {
                    "type": "string",
                    "description": "Default tab to show"
                }
            }
        },
        "topic_tags": {
            "type": "array",
            "items": {
                "type": "string"
            }
        },
        "dimensions": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "slug": {
                        "$ref": "definitions.json#/slug_relaxed"
                    },
                    "name": {
                        "type": "string"
                    },
                    "description": {
                        "type": "string"
                    },
                    "choices": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "slug": {
                                    "$ref": "definitions.json#/slug_relaxed"
                                },
                                "name": {
                                    "type": "string"
                                },
                                "group": {
                                    "type": "string"
                                },
                                "description": {
                                    "type": [
                                        "string",
                                        "null"
                                    ]
                                }
                            },
                            "required": [
                                "slug",
                                "name"
                            ]
                        }
                    }
                },
                "required": [
                    "slug",
                    "name"
                ]
            }
        },
        "views": {
            "type": "array",
            "items": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                    "dimensions": {
                        "type": "object",
                        "patternProperties": {
                            ".*": {
                                "type": "string"
                            }
                        }
                    },
                    "indicators": {
                        "type": "object",
                        "properties": {
                            "y": {
                                "oneOf": [
                                    {
                                        "type": "string"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "oneOf": [
                                                {
                                                    "type": "string"
                                                },
                                                {
                                                    "$ref": "#/$defs/indicatorConfig"
                                                }
                                            ]
                                        }
                                    },
                                    {
                                        "$ref": "#/$defs/indicatorConfig"
                                    }
                                ]
                            },
                            "x": {
                                "oneOf": [
                                    {
                                        "type": "string"
                                    },
                                    {
                                        "$ref": "#/$defs/indicatorConfig"
                                    }
                                ]
                            },
                            "size": {
                                "oneOf": [
                                    {
                                        "type": "string"
                                    },
                                    {
                                        "$ref": "#/$defs/indicatorConfig"
                                    }
                                ]
                            },
                            "color": {
                                "oneOf": [
                                    {
                                        "type": "string"
                                    },
                                    {
                                        "$ref": "#/$defs/indicatorConfig"
                                    }
                                ]
                            }
                        },
                        "required": [
                            "y"
                        ]
                    },
                    "config": {
                        "type": "object",
                        "description": "A subset of the grapher config.",
                        "properties": {
                            "$schema": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/$schema"
                            },
                            "addCountryMode": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/addCountryMode"
                            },
                            "compareEndPointsOnly": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/compareEndPointsOnly"
                            },
                            "selectedEntityColors": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/selectedEntityColors"
                            },
                            "relatedQuestions": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/relatedQuestions"
                            },
                            "relatedQuestionText": {
                                "type": "string",
                                "description": "Text for a related question link"
                            },
                            "relatedQuestionUrl": {
                                "type": "string",
                                "description": "URL for a related question link"
                            },
                            "title": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/title"
                            },
                            "map": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/map"
                            },
                            "maxTime": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/maxTime"
                            },
                            "subtitle": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/subtitle"
                            },
                            "selectedEntityNames": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/selectedEntityNames"
                            },
                            "focusedSeriesNames": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/focusedSeriesNames"
                            },
                            "baseColorScheme": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/baseColorScheme"
                            },
                            "yAxis": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/yAxis"
                            },
                            "tab": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/tab"
                            },
                            "matchingEntitiesOnly": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/matchingEntitiesOnly"
                            },
                            "hideLegend": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/hideLegend"
                            },
                            "hideLogo": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/hideLogo"
                            },
                            "timelineMinTime": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/timelineMinTime"
                            },
                            "variantName": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/variantName"
                            },
                            "hideTimeline": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/hideTimeline"
                            },
                            "originUrl": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/originUrl"
                            },
                            "colorScale": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/colorScale"
                            },
                            "scatterPointLabelStrategy": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/scatterPointLabelStrategy"
                            },
                            "selectedFacetStrategy": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/selectedFacetStrategy"
                            },
                            "sourceDesc": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/sourceDesc"
                            },
                            "invertColorScheme": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/invertColorScheme"
                            },
                            "hideRelativeToggle": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/hideRelativeToggle"
                            },
                            "comparisonLines": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/comparisonLines"
                            },
                            "internalNotes": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/internalNotes"
                            },
                            "version": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/version"
                            },
                            "logo": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/logo"
                            },
                            "entityType": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/entityType"
                            },
                            "facettingLabelByYVariables": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/facettingLabelByYVariables"
                            },
                            "note": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/note"
                            },
                            "chartTypes": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/chartTypes"
                            },
                            "hasMapTab": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/hasMapTab"
                            },
                            "stackMode": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/stackMode"
                            },
                            "minTime": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/minTime"
                            },
                            "hideAnnotationFieldsInTitle": {
                                "type": "boolean",
                                "description": "Whether to hide annotation fields in the title"
                            },
                            "excludedEntityNames": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/excludedEntityNames"
                            },
                            "xAxis": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/xAxis"
                            },
                            "timelineMaxTime": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/timelineMaxTime"
                            },
                            "hideConnectedScatterLines": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/hideConnectedScatterLines"
                            },
                            "showNoDataArea": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/showNoDataArea"
                            },
                            "zoomToSelection": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/zoomToSelection"
                            },
                            "showYearLabels": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/showYearLabels"
                            },
                            "hideTotalValueLabel": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/hideTotalValueLabel"
                            },
                            "hideScatterLabels": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/hideScatterLabels"
                            },
                            "sortBy": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/sortBy"
                            },
                            "sortOrder": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/sortOrder"
                            },
                            "sortColumnSlug": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/sortColumnSlug"
                            },
                            "hideFacetControl": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/hideFacetControl"
                            },
                            "includedEntityNames": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/includedEntityNames"
                            },
                            "entityTypePlural": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/entityTypePlural"
                            },
                            "missingDataStrategy": {
                                "$ref": "#/definitions/grapherSchemaRef#/properties/missingDataStrategy"
                            },
                            "yScaleToggle": {
                                "type": "boolean",
                                "description": "Whether to show a toggle for the y-axis scale"
                            },
                            "yAxisMin": {
                                "oneOf": [
                                    {
                                        "type": "number"
                                    },
                                    {
                                        "type": "string",
                                        "enum": [
                                            "auto"
                                        ]
                                    }
                                ],
                                "description": "Minimum value for the Y axis, or 'auto' for automatic scaling"
                            },
                            "type": {
                                "type": "string",
                                "description": "Chart type (e.g., LineChart, ScatterPlot, etc.)",
                                "enum": [
                                    "LineChart",
                                    "ScatterPlot",
                                    "StackedArea",
                                    "StackedBar",
                                    "DiscreteBar",
                                    "SlopeChart",
                                    "StackedDiscreteBar",
                                    "Marimekko"
                                ]
                            },
                            "facetYDomain": {
                                "type": "string",
                                "description": "How to handle y-axis domains in facets",
                                "enum": [
                                    "independent",
                                    "shared"
                                ]
                            },
                            "defaultView": {
                                "oneOf": [
                                    {
                                        "type": "boolean"
                                    },
                                    {
                                        "type": "string",
                                        "enum": [
                                            "true",
                                            "false"
                                        ]
                                    }
                                ],
                                "description": "Whether this view should be the default"
                            }
                        },
                        "additionalProperties": false
                    },
                    "metadata": {
                        "description": "Overrides metadata for the view. Takes precedence over the metadata override for all views.",
                        "$ref": "#/$defs/metadata"
                    }
                }
            }
        },
        "metadata": {
            "description": "Override metadata for all views.",
            "$ref": "#/$defs/metadata"
        }
    },
    "required": [
        "dimensions",
        "views"
    ],
    "$defs": {
        "indicatorConfig": {
            "type": "object",
            "properties": {
                "catalogPath": {
                    "type": "string"
                },
                "display": {
                    "description": "Overrides the display settings for the indicator.",
                    "type": "object",
                    "properties": {
                        "type": {
                            "type": "string",
                            "description": "The type of value to display",
                            "enum": [
                                "Integer",
                                "Decimal",
                                "Percentage",
                                "String",
                                "Ratio",
                                "Numeric",
                                "Currency",
                                "Population"
                            ]
                        },
                        "tolerance": {
                            "type": "number",
                            "description": "Tolerance for data comparison"
                        },
                        "sourceName": {
                            "type": [
                                "string",
                                "object"
                            ],
                            "description": "Name of the data source"
                        },
                        "additionalInfo": {
                            "type": [
                                "string",
                                "object"
                            ],
                            "description": "Additional information about the indicator"
                        },
                        "colorScaleNumericMinValue": {
                            "type": "number",
                            "description": "Minimum value for color scale"
                        },
                        "colorScaleScheme": {
                            "type": "string",
                            "description": "Color scheme to use for the data"
                        },
                        "colorScaleNumericBins": {
                            "type": "string",
                            "description": "Semicolon-separated values defining bins for color scale"
                        },
                        "sourceLink": {
                            "type": [
                                "string",
                                "object"
                            ],
                            "description": "Link to the data source"
                        },
                        "dataPublishedBy": {
                            "type": [
                                "string",
                                "object"
                            ],
                            "description": "Organization that published the data"
                        },
                        "color": {
                            "type": "string",
                            "description": "Color for the data series"
                        }
                    },
                    "additionalProperties": true
                }
            },
            "required": [
                "catalogPath"
            ]
        },
        "license": {
            "type": "object",
            "properties": {
                "name": {
                    "type": "string"
                },
                "url": {
                    "type": "string"
                }
            },
            "required": [
                "name",
                "url"
            ]
        },
        "metadata": {
            "$ref": "dataset-schema.json#/properties/tables/additionalProperties/properties/variables/additionalProperties"
        }
    }
}
